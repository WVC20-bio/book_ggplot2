\mainmatter

# (PART\*) Part I: Foundations {-}

# The Science and Art of Data Visualization {#visualization}

Before starting on the creation of graphs, this chapter discusses basic concepts of data visualization, as well as strategies for managing and organizing information in a structured way. Then, the choice of appropriate graphics according to human visual perception is explored, with emphasis on Gestalt principles and pre-attentive attributes. Finally, useful tools for data visualization are described.

## What is data visualization?

It is a __graphical representation__ of the data collected in your research (Figure \@ref(fig:data1)). There are various ways to display these data, such as bar charts, tables and maps, in order to __communicate__ the results of your studies. Therefore, inadequate data visualization can diminish the quality and hinder the progress of your research. \index{Data visualization}

In short, proper visualization __transforms data__, whether simple or complex, into simple representations (plots, tables and maps) that help people interact with and understand your data. 

```{r data1, echo = FALSE, message=FALSE,dpi=600, fig.cap= "Data visualization process.You must first optimize your data, then express it in graphs, charts, or maps using visualization tools, and finally share it with your audience.", fig.align='center', out.width='80%', fig.width= 6, fig.height= 4}
knitr::include_graphics(rep("images/data-fig-1.png"))
```

## Data management and storage

Your data is the heart of your research project. Therefore, efficient data management facilitates robust statistical analysis and results with 99.9% reliability. In addition to managing the data, it is essential to store them correctly using well-organized file structures and folders with appropriate and easily locatable names. This will allow others to easily reuse and share your data [@kanza2022].

### Data in a spreadsheet

Spreadsheets continue to be a widely used tool by researchers. Therefore, learning to structure our data effectively will facilitate the analysis and visualization process using specialized programs such as R.

Before entering the data collected from your research into a spreadsheet, take your time and think about how all your data should look in an orderly manner in your spreadsheet. I suggest you write down your idea of the structure on a piece of paper or in a notebook, creating a first sketch (Figure \@ref(fig:sketch)). Then, put it into your spreadsheet, recheck it, and restructure it if necessary. \index{Data visualization!data!spreadsheet}

```{r sketch, echo = FALSE,message=FALSE,dpi=600, fig.cap= "Sketch of a data structure. These data are a thought experiment in a format commonly seen in biological research.", fig.align='center', out.width='80%', fig.width= 6, fig.height= 4}
knitr::include_graphics(rep("images/sketch.png"))
```

Below is a summary of the principles for designing your data organized in spreadsheets, published by the article @broman2.

Your data should be organized in a single large rectangle (preferably) within a spreadsheet. In the rectangle, the columns represent a variable (time, glucose, sex) and the rows represent an observation (male, female), that is to say, the values of each variable (Figure \@ref(fig:data2)).

(ref:data2) Data in a spreadsheet. (A) In this data frame, there is a lack of consistency, which is why it has been classified as a negative data structure. (B) In this version of the previous data frame, there is greater consistency and clarity, which allows it to be imported into a data analysis and visualization program. 

```{r data2, echo = FALSE,message=FALSE,dpi=600,fig.cap= '(ref:data2)', fig.align='center', out.width='80%', fig.width= 6, fig.height= 4}
knitr::include_graphics(rep("images/data.png"))
```

Once the data has been entered, it is time to polish the structure. In panel A of Figure  \@ref(fig:data2), we see many deficiencies and one of them is the lack of coherence. 

In column B of the categorical variable sex, a single value should be used i.e. M and F or Male and Female, not a mixture of the two. Another problem that can be observed is the lack of data in the variable glucose. There are cases where not all data is complete and for these cases it would be necessary to use a clearly defined null indicator and avoid using text, numeric values (zero) and signs (-. +). The solution would be to leave blank spaces (compatible in most programs) or also to put `NA / na` (compatible for R). There are many examples of null values that should not be used, in the article @white2013, you are given a table with many options to indicate null values.

```{r dictionary, echo = FALSE,message=FALSE,dpi=600, fig.cap= "Data Dictionary. The first column indicates the name of the variable. The second column shows a more readable name of the variable, while the third column contains the description.", fig.align='center', out.width='80%', fig.width= 6, fig.height= 4}
knitr::include_graphics(rep("images/dictionary-data.png"))
```

Another important principle is to use concise variable label names. To improve the structure of our example of Figure \@ref(fig:data2) A, the individual variable would be replaced by the __id__ label, which tells us practically the same thing. Also, the values that are placed in the cells must be concise, whether it is numeric or categorical. In the variable glucose, its values would only be numeric, i.e. 120.2, 110.4, 111.5. The same goes for the time variable (Figure \@ref(fig:data2) B). 

Once your data are correctly structured, you can elaborate a data dictionary in a separate spreadsheet (Figure \@ref(fig:dictionary)). The purpose of this dictionary is to describe in detail what each variable represents, whether it is a measurement (mg, kg, cm, m) or a category, among others. This is especially useful when publishing your research along with the data, as it allows readers to understand the meaning and nature of the variables.

Finally, having version control of your data is a good security option. For research purposes, you may perform a subsequent analysis and you would like to add it to your dataset. Therefore, your original data should be backed up, you should create and maintain your versions of the data in different files, for example : data_v1.xlsx, data_v2.xlsx, etc. But, avoid manipulating your original data, it is counterproductive.

### Save data and organize in folders {#folders}

After you have your data versions, you should have a copy of your data as comma-delimited (CSV) files. CSV files have certain advantages as lightweight files and work in most data analysis and visualization programs such as R [@broman2].

(ref:organization) Project organized into different folders. Each folder represents elements of the project such as data, figures, and others. This organization of folders and files forms the basis of the book you are reading, and was developed primarily using an open source package known as Bookdown. \index{Data visualization!data!organization of folders}

```{r organization, out.width='100%',dpi=300,echo=FALSE,warning=FALSE, message=FALSE, fig.cap= '(ref:organization)', fig.align='center'}

knitr::include_graphics(rep("images/folders.png"))
```


Every research project should be organized using folders and sub-folders for data, figures, code, and other items (Figure \@ref(fig:organization)). This will allow you to easily find your data and any other relevant materials. Also, if you are working on a collaborative project, it is important to agree on the organization of the folders and define where to store data, figures, and code [@kanza2022].

## Data visualization and perception of visual elements.

Our brain gives us a personalized perception of the world. How does our brain accurately interpret graphs? This question has already been answered by several researchers over the last three decades. \index{Data visualization!visual elements}

@cleveland2 study focused on how __human perception__ affects our ability to decipher graphical presentations of data. Their goal was to identify which types of graphs make the best use of our abilities and which present the greatest difficulties. Years later, @heer5 replicated previous studies of spatial coding and luminance contrast. In addition, they conducted further investigations on the perception of rectangular areas (such as treemaps or cartograms), the size of graphics, and the spacing of grid lines. In @munzner20 book, presents a rough classification of the effectiveness of different channels for ordered (quantitative data) and unordered (categorical data) data. In addition to ranking them, he also orders them from the most effective to the least effective channels. 

(ref:classification) Schematic representation of an approximate classification of different channels for ordered quantitative and unordered categorical data. The visual elements located at the top are more effective compared to those located at the bottom. This image is mainly based on @munzner20 and @Schwabish20.

```{r classification, echo = FALSE, fig.cap= '(ref:classification)', fig.align='center', out.width='80%'}
library(knitr)

knitr::include_graphics(rep("images/clasification.png"))
```

From these investigations and others, we have a general idea of the most effective visual elements (easy to read) and of those visual representations that are less effective (difficult to read). In Figure \@ref(fig:classification) we have a general scheme of the classification of different channels for ordered and unordered categorical quantitative data. Channels are visual elements that together form a graph  

In ordered quantitative data, using visual elements such as bars or lines on the same axis facilitates comparison. On the other hand, if the axes are not aligned, interpreting the data becomes more complicated. Visuals that are represented as bars and lines are easy to read and interpret data values more accurately, while pie charts or 3D graphs make comparison difficult, which is why they are placed at the bottom of the schematic (Figure \@ref(fig:classification)).

Colors are a crucial tool in data visualization, but their use depends on the type of data you have. If we have as an example a data set formed by continuous variables, in this situation a sequential color scale would be used (Section \@ref(qualitative-color)). As examples, we have the grayscale gradient that varies only according to luminance making it easier to distinguish, while the red palette varies according to luminance and saturation; and it becomes complicated to use it to display a large number of different values.

However, in an example with ascendingly ordered categorical data, a sequential color scale could be used, but we must be careful in choosing the sequence of colors for the gradient. A better option is to use colors with different shades (Figure \@ref(fig:classification)).

### Gestalt principles 

Also known as the Laws of Gestalt (German word for form or shape). They describe how humans organize visual elements into groups. They are still relevant today and are applied in fields such as graphic design and data visualization [@Wong2010]. 
\index{Data visualization!Gestal principles}

(ref:gestalt) Illustration of the six Gestalt principles. These principles should be taken into account during the development of a chart.  

```{r gestalt, echo = FALSE, fig.cap= '(ref:gestalt)', fig.align='center', out.width='80%'}
library(knitr)
knitr::include_graphics(rep("images/gestalt.png"))
```

Here are six fundamental principles for designing graphics that take advantage of the way readers process information visually.

- **Proximity**: Elements in close proximity are often visually interpreted as part of the same set. In Figure \@ref(fig:gestalt), two groupings of dots are clearly distinguishable. This principle is useful when designing figures composed of several panels; for example, if you want readers to examine them in sequence, arranging them in a row would be most appropriate [@Wong2010]. 

- **Similarity**: Elements that share characteristics such as color, shape, size or direction tend to be perceived as part of the same group [@Wagemans2012]. In the figure above, five distinct groupings can be identified: the blue circles, the large circles, the gray diamonds, and the horizontally and vertically oriented bars.

- **Enclosure**: Elements located within the same area or region tend to be perceived as belonging to the same group. This principle can also be combined with others, such as grouping by similarity or by connection, thus reinforcing the visual perception of unity.

- **Continuity**: The human eye prefers to see a continuous flow of visual elements rather than separate objects. Therefore, readers tend to group those elements that appear to line up following the same direction or path, as shown in Figure \@ref(fig:gestalt).

- **Closure**: Open or incomplete forms tend to be perceived as closed, because we prefer complete forms and not to complicate ourselves. 

- **Connection**: This principle carries more weight than that of similarity, since we tend to perceive elements that are connected by a line as part of the same group, even if they differ in color, size or shape [@Schwabish20]. This feature is especially useful in the production of line charts, making them particularly easy to interpret. However, although it has a higher hierarchy, it does not reach the perceptual strength of the closure principle.

### Preattentive attributes

These are very effective visual resources that, when applied strategically, allow us to guide the reader's attention to a specific area of the graphic or text without requiring any conscious effort on their part. Preattentive attributes are present in every graphic we produce, so we should use them deliberately to direct the reader's attention to the key information we want them to see first. Figure \@ref(fig:attributes) provides some examples. \index{Data visualization!preattentive attributes}

(ref:attributes) Examples of preattentive attributes. Used strategically in our graphics, they allow us to draw the reader's attention to an area of interest. 

```{r attributes, echo = FALSE, fig.cap= '(ref:attributes)', fig.align='center', out.width='80%'}
library(knitr)
knitr::include_graphics(rep("images/attributes.png"))
```

Color is a very effective preattentive attribute that should be used strategically. Its application is not limited to the creation of graphics, but can also be used in blocks of text or by combining them. In the following chapters, several examples will be presented, such as the one shown in Figure \@ref(fig:fnt2).

## Data visualization tools

In recent decades, the volume and complexity of biological data have increased considerably. This increase is due, in part, to the frequent use of experimental techniques such as proteomics, transcriptomics and metagenomics. As a result, data visualization in this field has become crucial for communicating research results. Researchers are also devoting a great deal of effort to creating data-dense visualizations, a practical necessity in high-impact journals [@donoghue1;@donoghue2].

\index{Data visualization!tools}

To visualize our data, it is necessary to use specific __tools__, each with its own advantages and disadvantages (Table \@ref(tab:tools)). But each of them has a purpose, to ensure that both processed and unprocessed data are easily understood by the reader. Therefore, it is crucial to select the right tool carefully and spend time practicing its use. The article by @donoghue1, provides a detailed list of useful tools for researchers in science. I recommend that you read the article.

Table: (\#tab:tools) Data visualization tools.These tools have been divided into spreadsheets, data visualization software and programming libraries. Note: the tools marked with the superscript ("a") are not free of charge.

| Tools 	| Description 	| URL 	|
|---	|---	|---	|
| **Spreadsheets** 	|  	|  	|
| Microsoft Excel\textsuperscript{a}	| It is a very common   program that allows you to sort data, perform simple calculations, and   generate graphs.     	| https://www.microsoft.com/es-es/microsoft-365/excel    	|
| Google Docs Editors    	| It is a set of online   office tools. 	| https://workspace.google.com/products/docs/    	|
| LibreOffice    	| It includes several   applications that make it a free and open-source office suite.    	| https://es.libreoffice.org/ 	|
| **Data visualization**     	|  	|  	|
| SPSS\textsuperscript{a} | It offers statistical analysis,   graph creation, and tables.    	| https://www.ibm.com/es-es/products/spss    	|
| STATA\textsuperscript{a}  | Reproducible statistical   analysis, data visualization, data management, and automated reporting. It   also allows you to work with written commands.    	| https://www.stata.com/    	|
| Origin\textsuperscript{a}  | Allows you to create   interactive scientific graphics and data analysis.    	| https://www.originlab.com/    	|
| Tableau\textsuperscript{a} | For interactive   visualizations, including web based.    	| https://www.tableau.com/es-mx    	|
| MATLAB\textsuperscript{a} | It is a programming and   numerical calculation language used to analyze data, develop algorithms, and   create models    	| https://www.mathworks.com/    	|
| Power BI\textsuperscript{a}| Developed by Microsoft, it   allows you to analyze data and create interactive visualizations. It has a   paid version for collaborative work.    	| https://www.microsoft.com/es-es/power-platform/products/power-bi    	|
| GraphPad Prism\textsuperscript{a} | It combines scientific   graphics, comprehensive statistics, and data organization.     	| https://www.graphpad.com/    	|
| Python    	| Open source language that   enables data analysis and visualization, as well as the creation of web   applications.    	| https://www.python.org/    	|
| R    	| Open source language for   statistical computing and graphics.    	| https://www.r-project.org/    	|
| **Programming libraries**    	|  	|  	|
| ggplot2    	| Allows you to create various   graphics in R    	| https://ggplot2.tidyverse.org/    	|
| Matplotlib    	| Create static, animated,   and interactive visualizations in Python.    	| https://matplotlib.org/    	|


However, tools that address both data manipulation and data visualization are frequently used. Thus, we can classify them into three categories: __spreadsheets__, __data visualization software__ and __programming libraries__ [@srivastava]. 

Among the outstanding tools for data visualization is the R programming language, to which we devoted a more detailed explanation in Chapter \@ref(about-R). One of its main strengths is the large number of packages available, many of which offer specialized functions. An example of this is the __ComplexHeatmap__ package, which allows the creation of complex visualizations composed of multiple heat maps and annotations, ideal for representing data such as gene expression or DNA methylation, among others [@Gu2].

Although not included in the table, there are free web servers that facilitate the creation of various types of graphs, such as **SRplot**^[https://www.bioinformatics.com.cn/srplot]. This platform offers an accessible and free interface, especially useful for users with little or no programming experience. Simply paste the data to generate real-time graphs, which can be downloaded in formats such as SVG, PDF, among others [@Tang2].

However, SRplot has certain limitations. For example, it is not suitable for working with high-dimensional data. In addition, the customization of the graphs is limited, so it is necessary to resort to editing tools such as Inkscape or Adobe Illustrator. Finally, it does not provide the code used for the elaboration of the graphics [@Tang2].

SRplot can be a good starting point to get started in data visualization, but it is recommended to learn at least one programming language. R, for example, allows the code to be shared with the scientific community, thus promoting transparency and reproducibility of results.

## In conclusion

Data visualization allows the audience to easily understand the message you want to convey, using representations such as graphs, maps, tables or images. In other words, it is about telling a story through visual elements. There are several tools to achieve this, such as R and its ggplot2 library, which allow you to generate visualizations efficiently. However, when a higher level of customization is sought, such as the incorporation of images, specific colors or other details, it is necessary to resort to design programs such as Adobe Illustrator or Inkscape (See Appendix \@ref(tool)).
