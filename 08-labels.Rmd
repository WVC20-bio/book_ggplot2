
# (PART\*) Part III: Tips and strategies for figure design {-} 

# Labels {#labels}

In the second part of the book we have used several ggplot functions or extensions of it, to make different plots. In addition to learning how to elaborate figures (in the design aspect), the purpose is to convey the information of your data to the readers. All figures should be clearly labeled. A figure may include the following: 

- Title

- Subtitle

- Caption

- Axis title (x-y)

- Legend title

- Other labels: Error bars, confidence band and annotation lines.

Therefore, we must learn to properly label the figures and in this chapter we will address this issue.

## Title, subtitle and caption {#title-subtitle}

Every figure should include a title that orients the reader about its content. This title should be brief, concise and not exceed two lines. In this book, captions are not integrated into the figures; instead, they are presented as the first element of the caption, located below the figure. This style is widely used in the publication of books and academic articles (Figure \@ref(fig:dotplot2)). However, if you plan to use your figures in an infographic or on a web page, it is advisable to integrate titles, captions and the source of the data directly into the figures.

(ref:dotplot2) Infographic version of Figure \@ref(fig:dotplot). The title, subtitle and data source are integrated in the figure and aligned to the left. Note: To generate this graph we used the code published by Riffomonas Professional Development [@Schloss2023]. 

```{r dotplot2, fig.width = 5*6/4.2, fig.asp = 4.9*(0.12+1+.07)/7,dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE,fig.align='center',fig.cap= '(ref:dotplot2)'}

library(pacman)
pacman::p_load(
  ggtext,
  glue,
  tidyverse
  )

vaccine <- read.csv(
  file = "data/Chapter06/data-8KmKL.csv", 
  header = TRUE
  ) %>%
  rename(Country = X.1,
         Percent_august = "Total.Agree...August.2020",
         Percent_october = "Total.Agree...October.2020") %>%
  mutate(Label_august = 
           if_else(Percent_august < Percent_october,
                   Percent_august - 3,
                   Percent_august + 3),
         Label_october = 
           if_else(Percent_august < Percent_october,
                   Percent_october + 3,
                   Percent_october - 3))
vaccine2 = vaccine %>%
           pivot_longer(cols = -Country, 
                names_to=c(".value","Month"),
                names_sep = "_") %>%
           mutate(Country = factor(Country, 
                  levels = rev(vaccine$Country))) 
v = ggplot(vaccine2, aes(x = Percent,
                         y = Country,
                         color = Month))

v + geom_line(color="#e6e6e6", 
              size=1.75) +
  geom_point(size=3) + 
  labs(title = "If a vaccine for COVID-19 were available, I would get it",
       subtitle = "Ipsos survey of 18,526 adults in 15 countries",
       caption = "Data sources: Ipsos from October 8-13, 2020",
       x=NULL, y=NULL) +
  geom_text(aes(label=glue("{Percent}%"), x=Label),
            size=3.5, show.legend = FALSE) +
  scale_x_continuous(limits=c(50, 100),
                breaks=seq(50, 100, by=5),
                labels=glue("{seq(50, 100, 5)}%")) +
  scale_color_manual(name=NULL,
                breaks=c("august", "october"),
                values=c("#727272", "#15617b"),
                labels=c("Total agree - \nAugust 2020", 
                         "Total agree - \nOctober 2020"),
  guide = guide_legend(reverse = TRUE)) +
  theme_us_classic() +
  theme(plot.title.position = "plot", # Places the title in the whole plotting area
        plot.caption.position = "plot",
        plot.title = element_text(size = 16, face = "bold"),
        plot.subtitle = element_text(size = 12), 
        plot.caption = element_text(size = 12,
                      hjust = 0),
        axis.title = element_text(size = 12), 
        axis.text = element_text(size = 12),
        legend.title = element_text(size = 12),
        legend.text = element_text(size = 12),
        axis.line.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.x = element_text(color="gray50"),
        legend.position = "top",
        legend.justification = "left",
        legend.key = element_blank(),
        plot.margin = margin(4, 4, 0.1, 0.1))

```

Another important aspect to consider is text alignment. Titles and other textual elements aligned to the left are easier to read compared to those aligned to the center (Figure \@ref(fig:dotplot2)). A substantiated justification was mentioned in the book Storytelling whit data, Cole Nussbaumer mentions: "The audience starts by looking at the top left of your chart and will scroll down to form an imaginary “z” as they get information. For this reason, I prefer to justify the text in the upper left".

To distinguish the subtitle from the title, resources such as placing it in parentheses, changing its color or reducing its size can be used. In this case, we chose to reduce its size and keep it in black. On the other hand, the image caption is usually used to document data sources.

```{block2, title2, type='rmdtip'}

__Want to know more?__

- With the `labs()` function you can add titles, subtitles and captions. 

- The option `plot.title.position = “plot”` places the title and subtitle on the entire plot area, not on the panel.

```


## Axis title and legend {#axis-legend}

 The title of the axes (x-y) and the legend help us to show the values expressed by the data. Generally, the Y-axis title is presented rotated and aligned next to the vertical axis, while the X-axis title is arranged horizontally, located below the horizontal axis labels (Figure \@ref(fig:axis-legend)). 
 
There are other ways to position the axis titles that are also excellent choices. In Figure \@ref(fig:axis-option), the left chart shows the Y-axis title rotated and aligned to the right, while the X-axis title is aligned to the left. In the graphic on the right, the Y-axis title is presented horizontally and positioned above the vertical axis, functioning as a subtitle, while the X-axis title is still left-justified. 

(ref:axis-option) Options in positioning the axis titles. 

```{r axis-option, out.width = "0.9\\linewidth", fig.width = 6, fig.asp = 0.6, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:axis-option)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse,
        cowplot
        )

df <- data.frame(dose=c("A", "B"),
                len=c(20, 10))

p1 <- ggplot(df, aes(x = dose, y = len, 
        fill = dose, color = dose)) + 
      geom_col(width = 0.6) + 
      scale_y_continuous(expand = c(0,0)) + 
      labs(x = "Title X", y = "Title Y") + 
      scale_color_manual(values = c(
      "A" =  "#15617b",
      "B" = "#DBBF5A"
       )) + 
      scale_fill_manual(values = c(
      "A" =  "#15617b80",
      "B" = "#DBBF5A80"
       )) + 
      theme_us_classic() + 
      theme(axis.title.y.left = element_text(hjust = 1),
            axis.title.x = element_text(hjust = 0),
            axis.title = element_text(size = 16),
            legend.position = "none")

p2 <- ggplot(df, aes(x = dose, y = len,
      fill = dose, color = dose)) + 
      geom_col(width = 0.6) + 
      scale_y_continuous(expand = c(0,0)) + 
      labs(title = "Title Y", x = "Title X",
           y = "") + 
      scale_color_manual(values = c(
      "A" =  "#15617b",
      "B" = "#DBBF5A"
       )) + 
      scale_fill_manual(values = c(
      "A" =  "#15617b80",
      "B" = "#DBBF5A80"
       )) + 
      theme_us_classic() + 
      theme(axis.title.y.left = element_text(hjust = 1),
            axis.title.x = element_text(hjust = 0),
            axis.title = element_text(size = 16),
            plot.title = element_text(size = 16),
            legend.position = "none")

plot_grid(p1,p2, nrow = 1)

```

The legend provides the reader with additional information about the data. Although it usually includes a title, in some cases it can be omitted. Using the various arguments of the `theme()` function of *ggplot2*, it is possible to strategically adjust the position of the legend, facilitating a quick understanding of the information. Figure \@ref(fig:legend-position) shows several ways to optimally position the legend. 

(ref:legend-position) Tooth Growth by dose and the supplement type. Different positions of the legend: (A) Default position (Center-right). (B) Top-left. (C) Upper left corner. (D) Upper right corner. Source data: C. I. Bliss (1952) The Statistics of Bioassay. Academic Press.

```{r legend-position, fig.width = 5.5*6/3.2, fig.asp = 0.6,dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:legend-position)', fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse,
        aplot
        )

ToothGrowth$dose <- as.factor(ToothGrowth$dose)
# Default position
p1 <-  ggplot(ToothGrowth, aes(x=dose, y=len, 
       fill=supp, color = supp)) +
    geom_boxplot(position=position_dodge(0.8))+
  labs(x="Dose (mg)", y = "Length (mm)") +
  scale_fill_manual(values = c(
    "#D55E0090", "#0072B290"
  )) + 
  scale_color_manual(values = c(
    "#D55E00", "#0072B2"
  )) + 
  theme_us_classic()
# legend top-left
p2 <- ggplot(ToothGrowth, aes(x=dose, y=len, 
       fill=supp, color = supp)) +
  geom_boxplot(position=position_dodge(0.8))+
  labs(x="Dose (mg)", y = "Length (mm)") +
  scale_fill_manual(values = c(
    "#D55E0090", "#0072B290"
  )) + 
  scale_color_manual(values = c(
    "#D55E00", "#0072B2"
  )) + 
  theme_us_classic() + 
  theme( legend.position = "top",
  legend.justification= "left"
  )

p3 <- ggplot(ToothGrowth, aes(x=dose, y=len, 
       fill=supp, color = supp)) +
  geom_boxplot(position=position_dodge(0.8))+
  labs(x="Dose (mg)", y = "Length (mm)") +
  scale_fill_manual(values = c(
    "#D55E0090", "#0072B290"
  )) + 
  scale_color_manual(values = c(
    "#D55E00", "#0072B2"
  )) + 
  theme_us_classic() + 
  theme( legend.position = "left",
  legend.justification.left = "top"
  )

p4 <- ggplot(ToothGrowth, aes(x=dose, y=len, 
       fill=supp, color = supp)) +
  geom_boxplot(position=position_dodge(0.8))+
  labs(x="Dose (mg)", y = "Length (mm)") +
  scale_fill_manual(values = c(
    "#D55E0090", "#0072B290"
  )) + 
  scale_color_manual(values = c(
    "#D55E00", "#0072B2"
  )) + 
  theme_us_classic() + 
  theme( legend.position = "right",
  legend.justification.right= "top"
  )

aplot::plot_list(
  p1,p2,p3,p4, 
  ncol = 2, tag_levels = "A"
)

```

In Figure \@ref(fig:legend-position), panel (A) shows the default position of the legend, a common arrangement in scientific publications. In panel (B), the legend is placed in the upper left, a good alternative to placing it in the center. Panel (C) presents the legend in the upper left corner, while in panel (D) it is located in the upper right corner.

There are multiple ways to position the legend, but it is recommended to avoid placing it in the center or below the graph, as it may hinder the interpretation of the data.

Next we have a plot (Figure \@ref(fig:axis-legend)) showing the title of the axes and the legend duly done. Next, a dataset was employed that analyzes how biotic and abiotic factors influence the local distribution limits of a red alga (*Mazzaella parksii*) on the Washington coast [@Harley2003]. In our chart, the y-axis represents a numeric variable (area), so its title must specify the corresponding unit of measurement. It is important to be sure to include the units in the axis titles for numeric variables. On the other hand, categorical variables do not require units.

(ref:axis-legend) Mean surface area of algae at every combination of treatments. The legend and axis are titled. The unit of area is shown as cm, however, the original units are cm2, and n=16 in each combination of treatments. The error bars show the standard error of the mean (SEM).

```{r axis-legend, out.width = "0.9\\linewidth", fig.width = 6, fig.asp = 0.6, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:axis-legend)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse
        )

algae <- read.csv(
        file = "data/Chapter08/intertidal_algae.csv", 
        header=T, sep = ",")

ggplot(algae, aes(x = herbivores ,
       y = sqrtArea, color = zone)) + 
  stat_summary(aes(group = zone, y = sqrtArea), 
    fun.data = mean_se, geom = 'errorbar', width = 0.05, 
    size = 0.5, color = "gray50"
  ) +
  stat_summary(aes(group = zone, y =sqrtArea),
     fun.y = mean, geom = "line",
     color= "gray20", size = 0.5) + 
  stat_summary(aes(group = zone, y = sqrtArea,
                   shape = zone), 
    fun.y = mean, geom = 'point', width = 0.2, size = 4,
  ) + 
  scale_shape_manual(name = "Zone",
                     breaks = c("low", "mid"),
                     labels = c("Low","Mid"),
                     values = c(15,16)) + 
  scale_color_manual(name = "Zone",
                     breaks = c("low", "mid"),
                     labels = c("Low","Mid"),
                     values = c("#D55E00","#1876ba")) + 
  scale_y_continuous(limits = c(0,40),
                     expand = c(0,0)) + 
  scale_x_discrete(labels = c("Absent","Present")) +
  labs(y = "Square-root \nsurface area (cm)",
       x = "Herbivory treatment") + 
  theme_us_classic() + 
  theme(
    legend.key = element_blank()
  )
  

```

However, there are occasions when you can omit the axis titles or the legend. This is valid for categories such as months, years (Figure \@ref(fig:lineplot2)), sex or gender (Figure \@ref(fig:abolone)), and country names (Figure \@ref(fig:dotplot)), whose units are obviously clear.  

On the other hand, there are occasions when the legend can be integrated directly into the graphic. However, you should take care that the labels are concise. As shown in Figure \@ref(fig:axis-legend2), the legend labels (Mid-zone and Low-zone) are linked directly to the chart, using the same colors that represent the data. This approach strategically leverages the use of color for ease of interpretation.

(ref:axis-legend2) Mean surface area of algae at every combination of treatments. Compared to the previous Figure \@ref(fig:axis-legend), the legend labels were connected directly to the plot and are colored in the same color as the data. The error bars show the standard error of the mean (SEM).

```{r axis-legend2, out.width = "0.9\\linewidth", fig.width = 6, fig.asp = 0.6, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:axis-legend2)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse
        )

algae <- read.csv(
        file = "data/Chapter08/intertidal_algae.csv", 
        header=T, sep = ",")

ggplot(algae, aes(x = herbivores ,
       y = sqrtArea, color = zone)) + 
  stat_summary(aes(group = zone, y = sqrtArea), 
    fun.data = mean_se, geom = 'errorbar', width = 0.05, 
    size = 0.5, color = "gray50"
  ) +
  stat_summary(aes(group = zone, y =sqrtArea),
     fun.y = mean, geom = "line",
     color= "gray20", size = 0.5) + 
  stat_summary(aes(group = zone, y = sqrtArea,
                   shape = zone), 
    fun.y = mean, geom = 'pointrange', width = 0.2, size = 1,
  ) + 
  scale_shape_manual(name = "Zone",
                     breaks = c("low", "mid"),
                     labels = c("Low","Mid"),
                     values = c(15,16)) + 
  scale_color_manual(name = "Zone",
                     breaks = c("low", "mid"),
                     labels = c("Low","Mid"),
                     values = c("#D55E00","#1876ba")) + 
  scale_y_continuous(limits = c(0,40),
                     expand = c(0,0)) + 
  scale_x_discrete(labels = c("Absent","Present")) +
  labs(y = "Square-root \nsurface area (cm)",
       x = "Herbivory treatment") + 
  annotate("text",x = 2.28, y = 20,
        label = "Mid-zone",
        parse = TRUE,size = 14/.pt,
         color = "#1876ba") +
    annotate("text",x = 2.28, y = 8.5,
        label = "Low-zone",
        parse = TRUE,size = 14/.pt,
         color = "#D55E00") +
  theme_us_classic() + 
  theme(
    legend.key = element_blank(),
    legend.position = "none"
  )
  

```


## Other labels {#other-label}

### Error bars and confidence bands {#error-bar}

Error bars are another widely used resource in scientific publications due to their great usefulness. \index{error bars} They allow multiple estimates and their respective uncertainties to be represented simultaneously. In addition, they can be incorporated into various types of plots They are commonly found in bar plots (Figure \@ref(fig:error-bars)) and line plots, where they appear frequently in published papers.

Scientists often use error bars that represent the mean together with the standard error  of the mean (SEM) or standard deviation (SD). However, a dilemma arises as to which of these two options to report. To make this decision, it is critical for researchers to understand what information each provides. Figure \@ref(fig:error-bars) shows how presenting the same data as mean ± SE or mean ± SD can generate very different perceptions in the reader. The data set used shows chemical mimicry in a social insect parasite (*Malayatelura ponerophila*) by acquiring cuticular hydrocarbons (CHC) on the surface of the exoskeleton of its host ant (*Leptogenys distinguenda*) [@VonBeeren2011].

(ref:error-bars) Bar plots with different error bars. Data on ant aggressiveness toward different groups of silverfish are presented in bar plots showing mean ± SEM (Panel A), or mean ± SD (Panel B). La muestra para el grupo control es 6 y  

```{r error-bars, out.width = "0.9\\linewidth", fig.width = 6, fig.asp = 0.6, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:error-bars)',fig.align='center'}

library(pacman)
pacman::p_load(
        aplot,
        tidyverse,
        scales
        )

ant <- read.csv(
        file = "data/Chapter08/armyAnt_silverfish.csv", 
        header=T, sep = ",")


ant2 <- ant %>%
       dplyr::group_by(treatment) %>%
       dplyr::summarise(
         score = mean(aggressionScore),
         SD = sd(aggressionScore),
         SE = sd(aggressionScore)/sqrt(length(aggressionScore))
       )

a1 <- ggplot(ant2, aes(
      x = treatment, 
      y = score
)) + 
  geom_errorbar(aes(ymin = score,
   ymax = score + SE), color = "gray50",
   width = 0.1, size = 1) + 
  geom_col(aes(fill = treatment, 
               color = treatment),
  size = 1, width = 0.5) + 
  scale_y_continuous(limits = c(0,1.2),
    expand = c(0, 0), 
    breaks = seq(0, 1.2, by = 0.2),
    labels = label_number(accuracy = 0.1)) +
  scale_x_discrete(breaks = c(
    "Control", "Isolated"
  ), labels = c(
    "Control\n(n=6)", "Isolated\n(n=8)"
  )) + 
  scale_fill_manual(values = c("#E69F0080", "#56B4E980")) + 
    scale_color_manual(values = c("#E69F00", "#56B4E9")) + 
  labs(y = "Ant agression index", x = "Treatment",
       title = "Mean ± SEM") + 
  theme_us_classic() + 
  theme(legend.position = "none",
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size = 16, 
                    face = "bold"))


b1 <- ggplot(ant2, aes(
      x = treatment, 
      y = score
)) + 
  geom_errorbar(aes(ymin = score,
   ymax = score + SD), color = "gray50",
   width = 0.1, size = 1) + 
  geom_col(aes(fill = treatment, 
               color = treatment),
  size = 1, width = 0.5) + 
  scale_y_continuous(limits = c(0,1.2),
    expand = c(0, 0), 
    breaks = seq(0, 1.2, by = 0.2),
    labels = label_number(accuracy = 0.1)) +
  scale_x_discrete(breaks = c(
    "Control", "Isolated"
  ), labels = c(
    "Control\n(n=6)", "Isolated\n(n=8)"
  )) + 
  scale_fill_manual(values = c("#E69F0080", "#56B4E980")) + 
    scale_color_manual(values = c("#E69F00", "#56B4E9")) + 
  labs(y = "Ant agression index", x = "Treatment",
       title = "Mean ± SD") + 
  theme_us_classic() + 
  theme(legend.position = "none",
        axis.text.y = element_blank(),
        axis.title.y = element_blank(),
        plot.title = element_text(size = 16, 
                    face = "bold"))


plot_list(a1, b1, nrow=1, tag_levels='A')

```

The **standard deviation** (SD) reflects the variability or dispersion of individual values relative to the sample mean, while the **standard error of the mean** (SEM) indicates the probability that the sample mean deviates from the true population mean. It should be noted that the SEM is influenced by the sample size (SEM =  SD/√n), therefore the SEM bars shrink as we make more measurements [@Curran20]. There is a third type of error bars based on the **confidence interval** (CI). This type of bar, widely used in the medical literature, represents a range indicating the reliability of a measurement. It is common to use a 95% CI, as it provides a standard estimate of the precision of the data [@Krzywinski2013].

What type of error bars to use? In biological studies, it is common to compare the means of two or more groups, such as the results of experimental groups versus controls. In these cases, it is recommended to use inferential error bars, such as SEM or 95% CI, instead of SD (@Cumming2007;@Tang2019).

However, if the sample size (n) is small, showing error bars may not be meaningful. Instead, it is more appropriate to represent the full distribution of the data, plotting the individual points of each measurement (Figure \@ref(fig:strip-plot)).

(ref:strip-plot)  Strip plot showing the aggressiveness of ants on different groups of silverfish. The observations are shown as irregular blue dots and the line represents the mean of the samples. The strip plot clearly reveals that the sample sizes are small, that group one has significantly higher variance and that there is an outlier. These aspects are not evident in the bar graphs shown in Figure \@ref(fig:error-bars).

```{r strip-plot, out.width = "0.9\\linewidth", fig.width = 6, fig.asp = 0.6, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:strip-plot)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse,
        scales
        )

ant <- read.csv(
        file = "data/Chapter08/armyAnt_silverfish.csv", 
        header=T, sep = ",")


ggplot(ant, aes(
      x = treatment, 
      y = aggressionScore
)) + 
  geom_jitter(position=position_jitter(0.08),
              shape = 21,color = "#1876ba",
              fill = "#1876ba80",size = 3) + 
  stat_summary(fun = mean,
          fun.min= mean,
          fun.max = mean,
          geom = "crossbar", 
          size = 0.5,
          width = 0.2) +
  scale_y_continuous(limits = c(0,1.2),
    breaks = seq(0, 1.2, by = 0.2),
    labels = label_number(accuracy = 0.1)) +
scale_x_discrete(breaks = c(
    "Control", "Isolated"
  ), labels = c(
    "Control\n(n=6)", "Isolated\n(n=8)"
  )) + 
  labs(y = "Ant agression index", x = "Treatment") + 
  theme_us_classic() + 
  theme(legend.position = "none")



```


A scatter plot (Section \@ref(scatter-plot)) makes it possible to visualize trends in a data set by fitting a straight line or curve. In addition, it is possible to represent the uncertainty of this fitted line or curve by means of a confidence bands (Figure \@ref(fig:confidence-band) - Panel A). \index{confidence bands} This confidence bands the precision of the mean of the response variable (y-axis) as a function of each value of the explanatory variable (x-axis). In other words, it shows the different versions of the fitted line that could be consistent with the data. In addition, the plot can include prediction intervals, which reflect the accuracy of the individual Y values predicted for each X value. As shown in Figure \@ref(fig:confidence-band) - Panel B, these intervals are significantly wider than the confidence band (Figure \@ref(fig:confidence-band) - Panel A), since predicting the age of a specific lion based on the color of its nose carries greater uncertainty.

(ref:confidence-band)  Lion age versus proportion of their nose that is black, along with a best-fit regression line. 95% confidence bands (Panel A) for the predicted mean age of male lions at every value of proportion of black on their noses. 95% prediction intervals (Panel B) for the predicted age of single lions. Data source: @whitman2004

```{r confidence-band, echo=FALSE, error=FALSE, fig.align='center', fig.asp=0.75, fig.cap='(ref:confidence-band)', fig.width=5.5*6/4.2, message=FALSE, warning=FALSE, dpi=300}

library(pacman)
pacman::p_load(
        tidyverse,
        aplot
        )

lion <- read.csv(
        file = "data/Chapter08/lion_noses.csv", 
        header=T, sep = ",")

a1 <- ggplot(lion, aes(proportionBlack, ageInYears)) + 
    geom_smooth(method = "lm", se = TRUE, 
                color = "black",
                fill = "grey70") +
    geom_point(size = 3, shape= 21, color = "#1876ba",
               fill = "#1876ba80") + 
    labs(x = "Proportion black", y = "Age (years)",
         title = "Confidence bands") + 
    scale_y_continuous(
    limits = c(0,14),
    expand = c(0, 0), 
    breaks = seq(0, 14, by = 2)) + 
    theme_us_classic() + 
    theme(
     plot.title = element_text(size = 16, 
                    face = "bold")
    )

lionRegression <- lm(ageInYears ~ proportionBlack, 
                  data = lion) # Fit regression line

lion2 = data.frame(
        lion, predict(lionRegression, 
        interval = "prediction",level = 0.95)) # 95% Prediction interval

a2 <-  ggplot(lion2, aes(proportionBlack, ageInYears)) + 
    geom_ribbon(aes(ymin = lwr, ymax = upr, fill='prediction'), 
        fill = "black", alpha = 0.2) +
    geom_smooth(method = "lm", se = FALSE, col = "black") +
    geom_point(size = 3, shape= 21, color = "#1876ba",
               fill = "#1876ba80") +  
    labs(x = "Proportion black", y = "Age (years)",
         title = "Prediction interval") + 
    scale_y_continuous(
    limits = c(0,14),
    expand = c(0, 0), 
    breaks = seq(0, 14, by = 2)) + 
    theme_us_classic() + 
    theme(
     plot.title = element_text(size = 16, 
                    face = "bold",
                    ),
    axis.text.y = element_blank(),
    axis.title.y = element_blank()
    )

plot_list(a1, a2, nrow=1, tag_levels='A')

```


```{block2, label1 , type='rmdtip'}

__Want to know more?__

- Remember that the `geom_errorbar()` function of _ggplot2_ allows you to plot the error bars. 

- The function `stat_summary()` can be used to add mean/median points or lines. The argument `geom = “crossbar”` allows to add a line instead of a point. 

- You can customize your y-axis with the _scales_ package. For example, you can set decimals with the argument `labels =label_number(accuracy = 0.1)`.


```

### p-value {#p-val}

Before addressing the concept of p-value, it is important to remember what a hypothesis is and what hypothesis testing consists of. \index{p-value}

A hypothesis is a proposition about one or more populations. Hypothesis testing, which follows a series of steps and uses statistical techniques, evaluates whether or not this proposition is compatible with the available data [@daniel10].

Hypothesis testing works with two statistical hypotheses: 

- **Null hypothesis (H~0~)**: This is the initial assumption that there are no differences or relationships within the population of interest. It is usually formulated with the intention of being rejected. If, after applying the hypothesis testing procedure, the data provide significant evidence against the null hypothesis, it will be necessary to consider an alternative hypothesis.

- **Alternative hypothesis (H~a~):** It represents the research hypothesis and is the one to be tested.

What test tells me whether to accept or reject H~0~? The *p-value* is a significance measure that functions as an indicator of the strength of the evidence against the null hypothesis. In other words, it shows the degree of probabilistic compatibility between the observed result and H~0~ [@Dahiru2008].

The p-value is compared to an established significance level, usually 0.05, which is equivalent to a significance level of 5 %. If the p-value is less than or equal to this threshold (p ≤ 0.05), it is interpreted as a “significant result,” indicating evidence against the null hypothesis, since the observed result is unlikely to be the product of chance if H~0~ is true. In contrast, if the p-value is larger (p > 0.05), it is considered a “non-significant result”, suggesting that the differences between groups may be due to chance[@Cobo20;@daniel10].

Symbol              Meaning         Result    
------------------  --------------  -------------------  
ns                  p > 0.05        Not significant         
*                   P ≤ 0.05        Significant          
**                  P ≤ 0.01        Very significant     
***                 p ≤ 0.001       Highly significant           


We will now apply what we have learned through an example. Before we begin, it is important to point out that this analysis does not delve into statistical aspects, as this is not the purpose of this book. However, there are numerous books and articles devoted specifically to the study of statistics.

We will again use the `ToothGrowth` dataset, incorporated in R. This dataset comes from a study that investigated the relationship between vitamin C and tooth growth in guinea pigs. In this investigation, the response variable is the length of odontoblasts, the cells responsible for tooth growth, in a total of 60 guinea pigs. Each animal received one of three doses of vitamin C (0.5, 1 and 2 mg/day) via one of two methods of administration: orange juice (OJ) or ascorbic acid, a form of vitamin C represented as VC [@bliss20].

```{r}
library(pacman)
pacman::p_load(
        tidyverse)

d <- ToothGrowth # Original data

d <- d %>%
     mutate(dose = as.factor(dose))

head(d,4)
```

Knowing the information in our data, we will now perform the data analysis, i.e. hypothesis testing. 

For each comparison, we will consider the following hypotheses:

**H~0~:** The methods of administration (Orange Juice or Ascorbic Acid), for a given dose level, there is no difference in average tooth growth.

**H~a~:**  The methods of administration (Orange Juice or Ascorbic Acid), for a given dose level, there is a difference in average tooth growth.

*Recall: All p values were compared at a significance level of 5% ($\alpha$ = 0.05).*

Before selecting a statistical inference method or technique, it is essential to determine whether the data follow a normal distribution by means of normality tests. This initial step is crucial, since the results obtained will define whether a parametric or nonparametric statistical method should be used. 

Visually we can infer whether our data have a normal distribution. The histogram, density plot and Quantile-Quantile (Q-Q plot) are good options (Figure \@ref(fig:visual-method)). 

(ref:visual-method) Visual methods showing the distribution of data: (A) in the form of a histogram and (B) by Q-Q plot.  

```{r visual-method, fig.width = 5.5*6/3.1,fig.height= 6, fig.asp = 0.6, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:visual-method)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse,
        aplot
        )

d <- ToothGrowth

d <- d %>%
     mutate(dose = as.factor(dose))
# Histogram
p1 <- ggplot(d, aes(x = len,
      fill = supp, color = supp)) + 
geom_histogram(bins = 10, size = 1) +
scale_y_continuous(expand = c(0,0),
breaks = c(0,2.5,5,7.5,10),
labels = c(0,2.5,5,7.5,10)) +
scale_fill_manual(values = c("#D55E0090","#0072B290")) + 
scale_color_manual(values = c("#D55E00","#0072B2")) +
labs(x = "Length (mm)",
     y = "Frequency") + 
facet_wrap(~supp, ncol = 1) +
coord_cartesian(ylim = c(0,10)) + 
theme_us_classic() + 
theme(strip.text = element_text(size = 14,
  hjust = 0), strip.background = element_rect(
  fill = "grey85",colour = "grey85",
  linetype = 1, size = 0.25), legend.position = "none")
# Q-Q plot
model <- lm(len ~ dose + supp, data=d) # Linear regression
p2 <- ggplot(d, aes(sample = rstandard(model))) + 
stat_qq_line() +
stat_qq(aes(fill = supp, color = supp),
size = 2.5) + 
labs(x = "Theoretical", 
           y = "Observed") + 
scale_fill_manual(values = c("#D55E00","#0072B2")) + 
scale_color_manual(values = c("#D55E0090","#0072B290")) +
facet_wrap(~supp, ncol = 1) +
theme_us_classic() + 
theme(strip.text = element_text(size = 14,
hjust = 0), strip.background = element_rect(
fill = "grey85",colour = "grey85",
linetype = 1, size = 0.25), 
legend.position = "none")  

aplot::plot_list(p1,p2,ncol = 2,
        tag_levels = "A")

```

In panel A of Figure \@ref(fig:visual-method), two histograms corresponding to both supplements are presented. Recall that a histogram (Chapter \@ref(continuous-x)) is a graph that represents a continuous variable divided into intervals, where the height of each bar is proportional to the frequency of the data in that range. At first glance, histograms show a shape similar to a bell curve, characteristic of a normal distribution (**Gaussian curve**). To confirm this observation, a Q-Q plot (Chapter \@ref(continuous-x)), shown in panel B, was used. This plot compares the theoretical quantiles of a distribution with the quantiles observed in the data. If the points line up with the diagonal line (linear regression fit), it suggests that the data follow a normal distribution. 

However, to confirm with greater certainty, we will perform a normality test. There are several methods for this, the best known being the **Kolmogorov-Smirnov** (KS) test and the **Shapiro-Wilk** test. In this case, the Shapiro-Wilk test was chosen, since it is widely recommended and is considered more robust than the Kolmogorov-Smirnov test [@Ghasemi2012].

Having identified which test to perform, it is important to remember that your null hypothesis states that “the sample distribution is normal” (H~0~: X ∼ Normal). Therefore, the data will be considered not to follow a normal distribution if the observed evidence contradicts this hypothesis, i.e., if the test result is significant.

```{r}
library(pacman)
pacman::p_load(
        rstatix)

d %>%
  group_by(dose,supp) %>%
  shapiro_test(len) %>%
  head(4)

```

The Alboukadel Kassambara [rstatix](https://rpkgs.datanovia.com/rstatix/index.html) package was used for this and the other tests. The test was carried out considering both doses and supplement (pooled data), obtaining a p value > 0.05. Therefore, the null hypothesis, which states that the distribution is normal, is not rejected, and it is concluded that any deviation from normality is not statistically significant.

```{block2, test-normal, type='rmdtip'}

__Want to know more?__

- When sample sizes are large (> 30 or 40) as in our exercise (n = 60) the distribution of sample proportions tends to be normal according to the central limit theorem [@Ghasemi2012].

- It is important to consider that normality tests are sensitive to small samples and have limited ability to reject the null hypothesis. Therefore, supplementing these analyses with visual inspection may be a useful strategy to assess the normality of the data [@Ghasemi2012].

```

With these results, we could opt for a parametric statistical method, such as **Student's t-test** or **Analysis of Variance** (ANOVA). However, these tests assume that the variances between groups are equal. Therefore, as a complementary analysis, it would be advisable to perform a test of variance to verify whether the variances are homogeneous in two or more groups.

There are different variance tests and among the main ones we have: 

Test                Type    
------------------  --------------   
F-test	             Parametric        
Bartlett’s test	     Parametric          
Jackknife test       Non-Parametric    
Levene’s test        Both  


**Levene's** (selected) test assumes that the data are independent and normally distributed. The test does not depend on sample variances, therefore, it is not very sensitive to outliers[@Zhou2023]. We will use the `levene_test()` function from the **rstatix** package. \index{levene\_test, rstatix}

```{r}

library(pacman)
pacman::p_load(
        tidyverse)

d <- ToothGrowth

d <- d %>%
     mutate(dose = as.factor(dose))

levene_test(len~interaction(dose, supp), data=d)

```

According to the test result, it is not significant (p = 0.1483), therefore the alternative hypothesis is accepted: the variations of the populations are different.

With all these results we can now choose a parametric statistical method and the best option would be to perform the Student's t-test or t-test. This test is used to compare the means between two independent groups [@Mishra2019].

There are two types of Student's t-tests, and due to the characteristics of our data, we will apply a two-sample t-test, also known as an independent samples t-test.

To begin, we will calculate some descriptive statistics of the data using the `get_summary_stats()` function.

```{r}
d %>%
  group_by(dose,supp) %>%
  get_summary_stats(len,show = c("mean", "sd"))

```

From these preliminary results, we can infer that the administration of orange juice (OJ) has a greater influence on average tooth growth in the first two doses. However, at a dose of 2 mg, treatment with Ascorbic Acid or vitamin C (VC) is more effective. To confirm this observation, we will perform a two-sample t-test, and the p-value will be displayed in the graphs (Figure \@ref(fig:p-value)).

```{r}

library(pacman)
pacman::p_load(
        rstatix)

d <- ToothGrowth

d <- d %>%
     mutate(dose = as.factor(dose))

t_test <-   d %>%
  group_by(dose) %>%
  t_test(len ~ supp) %>%
  adjust_pvalue(method = "bonferroni") %>%
  add_significance("p.adj")

t_test

```

With our results from the t-Student, we need to add it to our plot generated in ggplot2 (Figure \@ref(fig:p-value)) and for this we will use the function stat_pvalue_manual() from the [ggpubr](https://rpkgs.datanovia.com/ggpubr/index.html) package [@kassambara10].

(ref:p-value) Tooth Growth by dose and the supplement type. Box plot together with gray dot plots showing the values for each individual and the black diamond represents the mean. (A) the p-value for each dose is plotted. (B) The p-value is represented by symbols * (p ≤ 0.05), ** (p ≤ 0.01) and ns (p > 0.05).

```{r p-value, fig.width = 5.5*6/3.1,fig.height= 6, fig.asp = 0.62, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:p-value)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse,
        rstatix,
        ggpubr,
        aplot
        )

d <- ToothGrowth

d <- d %>%
     mutate(dose = as.factor(dose))

t_test <-   d %>%
  group_by(dose) %>%
  t_test(len ~ supp) %>%
  adjust_pvalue(method = "bonferroni") %>%
  add_significance("p.adj")

label_dose <- c(
  "0.5 mg", "1 mg", "2 mg"
)

names(label_dose) <- c(
  "0.5", "1", "2"
)

g <- ggplot(d, aes(x=supp, y=len)) +
  geom_boxplot(aes(fill=supp, color = supp),
  position=position_dodge(0.8), outlier.shape = NA)+
  geom_dotplot(binaxis='y', stackdir='center',
  position = position_nudge(x = 0.25), 
  fill = "gray90", color = "gray40") +
  stat_summary(position=position_dodge(0.8),
  geom = "point", fun = mean,shape = 18,
  size = 3.5) + 
  scale_fill_manual(values = c(
    "#D55E0090", "#0072B290"
  )) + 
  scale_color_manual(values = c(
    "#D55E00", "#0072B2"
  )) + 
  facet_wrap(~dose, scales = "free_x",
  labeller= labeller(dose=label_dose)) +
  scale_y_continuous(limits = c(0,40),
  expand = c(0,0)) + 
  scale_x_discrete(breaks = c(
    "OJ", "VC"), labels = c(
      "Orange\njuice", "Ascorbic\nacid"
    )) + 
  labs(x="Supp", y = "Length (mm)") +
  coord_flip() + 
  theme_us_classic() + 
  theme( legend.position = "none",
  axis.title.y = element_blank(),
  axis.title.x = element_text(hjust=0),
  strip.text = element_text(size = 14,
  hjust = 0), strip.background = element_rect(
  fill = "grey85",colour = "grey85",
  linetype = 1, size = 0.25),
  panel.spacing.x =  unit(0.6, "cm"),
  plot.margin = margin(t = 3, r = 9, 
  b = 2, l = 2)
  ) 

p3 <- g + stat_pvalue_manual(t_test, 
    label = "p = {p}", y.position = 34,
    color = "gray30",remove.bracket = TRUE,
    vjust = -2.8)

p4 <- g + stat_pvalue_manual(t_test, 
    label = "p.adj.signif", y.position = 34,
    color = "gray30",remove.bracket = TRUE, 
    vjust = -2, size = 5)

aplot::plot_list(
  p3,p4,ncol = 1, tag_levels = "A"
)

```

In panel A of Figure \@ref(fig:p-value), a significant difference in mean tooth growth is observed for doses of 0.5 mg/day (p = 0.00636) and 1 mg/day (p = 0.00104) when orange juice was administered compared to ascorbic acid. However, at a dose of 2 mg/day, the results were virtually the same between the two methods of administration, indicating no significant difference (p = 0.964) in mean tooth growth. Panel B shows the same results, but represented by symbols. Both forms of visualization are widely used in scientific publications in Biology and Medicine. 

Finally, the following was concluded from this analysis:

Increasing the dose of vitamin C favors higher mean tooth growth in guinea pigs (2 mg/day > 0.5 mg/day). At the initial doses (0.5 mg/day and 1 mg/day), administration in the form of orange juice showed better results compared to ascorbic acid. However, when receiving 2 mg/day of vitamin C, both in the form of orange juice and ascorbic acid, the results in mean tooth growth were practically the same.

```{block2, p-limits, type='rmdcaution'}

__Is the p-value effective?__

Some scientists have questioned the use of the p-value, as it provides a limited interpretation of the data and can be easily misinterpreted [@Halsey2019].

One of its main limitations is that it is based on the assumption that the null hypothesis is true, but does not provide information about the alternative hypothesis, which is usually the main focus of interest. Moreover, when the p-value is high (close to 0.05) and the null hypothesis is not rejected, this does not necessarily imply that the null hypothesis is true.

Another restriction of the p-value is its strong dependence on sample size; with a sufficiently large sample size, it is almost inevitable that the null hypothesis will be rejected. Also, some researchers point out that the p-value is “fragile” in that it can exhibit variations between different samples within a single study.

Despite these limitations, the p-value is still widely used in scientific research. However, many experts suggest that it should be considered as a first filter and complemented by other statistical approaches to gain a better understanding of the variability in the results.

```

### Annotation lines {#annotation-line}

A plot can be customized much more, when you add text annotations, lines, areas, arrows, etc. The following table shows a list of functions for annotation with ggplot2:

Function                           Description           
---------------------------------  -----------------------------------------   
geom_text()                        Adds text directly to the plot.                 
geom_label()                       Draws a rectangle underneath each label.              
geom_rect()                        Highlighting rectangular regions.          
geom_segment()                     Add lines or arrows.                
annotate()                         Auxiliary function to add small text annotations and geoms to a plot. 
geom_abline()                      For regression lines
geom_hline()                       For horizontal lines               
geom_vline()                       For vertical lines 


In some cases, it is necessary to label multiple texts or values in a scatter plot. \index{geom\_text function} Although the `geom_text()` function can be useful for this task, it offers limited control over the overlapping of labels with the points on the plot. To solve this problem, the [ggrepel](https://ggrepel.slowkow.com/authors#citation) package[@kamil] provides the `geom_text_repel()` function, which automatically (or manually) adjusts the position of labels to avoid overlaps. \index{geom\_text\_repel}

(ref:annotation) A timeline of antibiotic drug development. Note: Graph based on the publication by @antibiotics. 

```{r annotation, fig.width = 5.5*6/3.1,fig.height= 6 , fig.asp = 0.9, dpi=300,echo=FALSE,error=FALSE, warning=FALSE, message=FALSE, fig.cap= '(ref:annotation)',fig.align='center'}

library(pacman)
pacman::p_load(
        tidyverse,
        data.table,
        readxl,
        scales,
        ggtext
        )

drugs <- read_xlsx(path = 
        "data/Chapter08/Antibiotic drug development.xlsx",
         col_names = TRUE) %>%
         dplyr::arrange(Year_introduced)

setDT(drugs)[, id := .GRP, by = Antibiotic_class]

drugs<-  drugs %>%
         mutate(
           Example_drug = recode(
             Example_drug, Amoxicillin = "Amoxicillin, penicillin"
           ))

orden_source <- c(
  "Synthetic", "Other bacteria","Fungi","Actinomycetes")


drugs<-  drugs %>%
         mutate(
          Source_of_antibiotic = as.factor(Source_of_antibiotic),
          Source_of_antibiotic = fct_relevel(Source_of_antibiotic,
                                orden_source)
         )

colors <- c("Actinomycetes" = "#0072B2", 
            "Other bacteria" = "#D55E00", 
            "Fungi" ="#CC79A7",
            "Synthetic" = "#009E73")

an_label <- tibble(
  label = c(
    "<span style = 'color:#ba926b;'>First used in 1910,arsphenamines<br>were the first synthetic antibiotics<br>, and treated infections like syphilis.<br>Progress lagged as scientists<br>struggled to find and develop others.</span>",
   "<span style = 'color:#ba926b;'>Tetracyclines are effective against a wide<br>range of bacteria, both Gram-negative<br>and Gram-positive, and treat cholera,<br>respiratory infections, acne, and various<br>other diseases.</span>",
   "<span style = 'color:#ba926b;'>Cephalosporins, introduced in 1964,<br>offered an alternative for treating<br>penicillin-resistant infections and<br>patients allergic to penicillin.</span>", 
   "<span style = 'color:#ba926b;'>Penicillin was discovered by Alexander<br>Fleming in 1928, but it took until 1943 to<br>scale up production. It revolutionized<br>treatment during World War II.</span>",
   "<span style = 'color:#ba926b;'>Streptomycin was the first of many<br>antibiotics derived from actinomycetes<br>bacteria. It transformed the treatment<br>of tuberculosis and bubonic plague.</span>"
  ), 
  x = c(1892,1985,1989,1985,1892),
  y = c(8,14,26.5,9,13),
  hjust = c(0,0,0,0,0),
  vjust = c( 0,0,0,0,0)
)

ggplot(drugs, aes(x=Year_introduced, 
            y=id, label=Antibiotic_class)) +
geom_point(aes(color=Source_of_antibiotic),size=2.5,
          stroke=0.8) +
geom_text(hjust=1, nudge_x=-2.5, size=3.5) + 
geom_text(aes(label=Example_drug), hjust=0, nudge_x=2.5, 
         size=3.5, color="gray50") + 
scale_color_manual(values = colors) + 
labs(title="Timeline of the development of antibiotic drugs",
    subtitle="The year when each <span style = 'color:black;'>antibiotic drug class</span> was first introduced for medical use,<br> alongwith its <span style = 'color:black;'>source</span> and an <span style = 'color:gray50;'>example antibiotic for each drug class</span>. ",
    x="",
    y="",
    caption="<span style = 'color:gray30;'>Source data:</span> Hutchings, Truman, Wilkinson (2019) Antibiotics: Past, present and future.<br><br> <span style = 'color:gray30;'>Reference plot:</span> Saloni Dattani (2024) What was the Golden Age of Antibiotics, and how can we spark a new one?<br>") +
geom_richtext(data=an_label, 
  aes(x = x, y = y, label = label, 
  hjust = hjust, vjust = vjust), 
   fill = NA, label.color = NA, size = 3) + 
annotate(
    geom = "curve", x = 1892, y = 4, 
    xend = 1895, yend = 1.8, curvature = -0.2, 
    arrow = arrow(length = unit(2, "mm")),
    color = "#ba926b"
  ) + 
annotate(
    geom = "curve", x = 1985, y = 10, 
    xend = 1965, yend = 9, curvature = 0.1, 
    arrow = arrow(length = unit(2, "mm")),
    color = "#ba926b"
  ) + 
annotate(
    geom = "curve", x = 1989, y = 24, 
    xend = 1979, yend = 25, curvature = -0.1, 
    arrow = arrow(length = unit(2, "mm")),
    color = "#ba926b"
  ) + 
annotate(
    geom = "curve", x = 1985, y = 6, 
    xend = 1968, yend = 5, curvature = 0.1, 
    arrow = arrow(length = unit(2, "mm")),
    color = "#ba926b"
  ) + 
annotate(
    geom = "curve", x = 1925, y = 10, 
    xend = 1928, yend = 7.5, curvature = 0.2, 
    arrow = arrow(length = unit(2, "mm")),
    color = "#ba926b"
  ) + 
coord_cartesian(xlim=c(1898,2025),
                ylim = c(38,1)) +
scale_y_reverse() + 
scale_x_continuous(
    breaks= seq(1900,2020,by=10), 
    labels = seq(1900,2020,by=10),
    position = "bottom") +
  theme_us_classic() + 
  theme(plot.title = element_text(size = 25, 
        color = "#ba926b", face = "bold", family = "serif"),
        plot.title.position = "plot",
        plot.subtitle = element_textbox_simple(size = 18,
        color = "gray30", family ="serif"),
        plot.caption.position = "plot",
        plot.caption = element_markdown(size = 10,
        color = "gray50", hjust = 0, family = "serif"),
        legend.title = element_blank(),
        legend.justification =  "top",
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        axis.line.y = element_blank(),
        axis.title.x.top = element_text(vjust = 1.5),
        axis.text.x.top = element_text(vjust = 1.5),  
        axis.ticks.x.top = element_line(),        
        plot.margin = margin(t = 10, r = 10, b = 10, l = 10))
```

Claus O. Wilke's ggtext package provides support for Markdown in both thematic elements (titles, subtitles, axis labels, etc.) and geoms. In both cases, you can generate simple text labels and another to create text boxes with line wrapping. In Figure \@ref(fig:annotation) we have an example of an infographic type. Here we took advantage of the functions `geom_tex(ggplot2)`, `annotate(ggplot2)` and `geom_richtext(ggtext)`. 

The `geom_text()` function was used to label one drug example per antibiotic class. Subsequently, additional annotations were made with `geom_richtext()`, since it allows the use of Markdown/HTML tags. To connect these annotations with the corresponding arrows, the `annotate()` function was used. 

Since the plot is large and the legend was too far away, it was relocated to the upper right so that the reader can quickly identify it. In addition, the title of the legend was removed because it was highlighted in the subtitle.

A title, subtitle, and caption were added to the graph. In the subtitle, color was strategically used to highlight (Chapter \@ref(color)) keywords related to the graph, such as antibiotic class, source, and antibiotic example for each class. This was made possible by the ggtext package. In addition, for further customization, the typography of the title, subtitle and caption was modified. In Chapter \@ref(changes-design), the different ways to change the font are explained.

## In conclusion 

Every chart must be correctly labeled. This chapter introduces the basic principles for setting up the layout of charts. Initially, the essential labels of a graph, such as axis titles and legend title, have been addressed, as well as the importance of strategically placing the legend to facilitate its interpretation by the reader.

Subsequently, other relevant graphical elements have been discussed, such as error bars, confidence bands, p-values and annotation lines. Error bars are key tools for representing variability in a data set, the most commonly used measures being the standard deviation (SD), standard error of the mean (SEM) and confidence interval (CI).

The p-value, another common label in graphs, allows a general display of whether the null hypothesis is rejected or not, although it has certain limitations. Finally, it is possible to customize the plots by strategically incorporating annotation lines, using tools such as ggplot2 or additional packages.

## To practice!

### Exercise 1

We will use a data set designed to predict the growth of commercial sugarcane (CTC4) and energy cane (Vertix 12) varieties treated with or without Ethephon [@DeAbreu2020]. The plot you will create will be a strip chart, in which you will use the `stat_summary()` function to highlight the average of each group. In addition, you will design the chart in an infographic style, including a title, subtitle and caption.

```{r, warning=FALSE, message=FALSE, error=FALSE,eval=FALSE}

library(pacman)

pacman::p_load(
        tidyverse,
        readxl)


data <- read_xlsx(path = 
        "data/Chapter08/Modelo_Ethephon.xlsx",
         col_names = TRUE)

```


### Exercise 2

Create a scatter plot representing the relationship between brain weight and body weight in different mammalian species [@jerison20]. Each point should be clearly labeled using the `geom_text_repel()` function. Make sure that the scales are in base 10 logarithm. Also, position the Y-axis title horizontally to the right side and adjust the X-axis title to the left using the `element_text(hjust)` argument. Do not forget to include the corresponding units in the titles of both axes.

```{r, warning=FALSE, message=FALSE, error=FALSE,eval=FALSE}

library(pacman)

pacman::p_load(
        tidyverse,
        scales,
        ggrepel)


mammals <- c("Mole","Vampire \nbat", "Rat",
             "Opossum", "Wolf", "Baboon",
             "Australopithecus", "Male gorilla",
             "Modern human", "Porpoise",
             "Lion", "Chimpanzee", "Blue whale",
             "Elephant")

body_mass  <- c(0.03,0.03,0.3,
                2,30,20,
                40,300,
                60,100, 
                200, 50, 70000,
                9000)

brain_mass <- c(0.3,1,3,
                6,200,250,
                400,500,
                2000,2500,
                200, 300,9000,
                8000)

data <- data.frame(mammals,body_mass,brain_mass)

```
