---
title: "Chapter12"
author: "William Vilchez Cruz"
date: '2025-02-12'
output: html_document
---

## Exercise 1

```{r}

library(pacman)
pacman::p_load(
   tidyverse,
   ggtext,
   scales,
   readxl,
   glue
  )

b_mass_order <- c(
  "Obese", "Overweight","Normal",
  "Underweight"
)


body_data <- read_xlsx(
  path = "data/Chapter12/body_cdc.xlsx",
  col_names = TRUE) %>% 
  mutate(b_mass_index = as.factor(b_mass_index)) %>%
  mutate(b_mass_index =  fct_relevel(b_mass_index,b_mass_order))
  

body_label <- tribble(~label,~x,~val,~body,
              "Obese",0.1, 90, "Obese",
              "Overweight", 0.1,60,"Overweight",
              "Healthy weight", 0.1, 30, "Normal",
              "Underweight", 0.1, 3.2, "Underweight"
)

ggplot(body_data, aes(
  x = sex, y = value)) + 
geom_col(aes(fill = b_mass_index,
             color = b_mass_index ),
         width = 0.4) + 
scale_y_continuous(expand = c(0,0),
  labels = scales::percent_format(
        accuracy = 1, scale = 1)) + 
scale_x_discrete(breaks = c(
  "female", "male"
), 
labels = c(
  "Female", "Male"
)) + 
geom_text(data = body_label,
  mapping = aes(x = x, y = val,
  color = body, label = label),
  hjust = 0, lineheight = 0.8, 
  size = 14, size.unit = "pt", 
  show.legend = FALSE

) + 
geom_text_repel(aes(
  label=glue("{value}%"),
              x= sex
), size = 14/.pt,
 position = position_stack(0.8),
direction = "x",
 hjust = -1.7,
segment.size = 0.7,
segment.alpha = 0.5,
) + 
scale_fill_manual(values = c(
 "Obese" = "#0072B280", 
"Overweight" = "#009E7380",
"Normal" = "#D55E0080",
"Underweight" = "#CC79A780"
)) + 
scale_color_manual(values = c(
 "Obese" = "#0072B2", 
"Overweight" = "#009E73",
"Normal" = "#D55E00",
"Underweight" = "#CC79A7"
))  +
labs(x = "",
     y = "",
     title = "Percent of population by weight level",
     subtitle = "Population is adults aged 18 years and older. Survey conducted in the United States, 2017.", 
     caption = "Source data: CDC (Table A-15c, 2018)") +
coord_cartesian(xlim = c(0.5,2.2),
                clip = "off") +
theme_us_classic() +
theme(axis.ticks = element_blank(),
      axis.text.y = element_blank(),
      axis.line.y = element_blank(),
      legend.position = "none",
      plot.margin = margin(t = 5, r = 10,
            b = 2, l = 3),
      plot.title.position = "plot", 
      plot.title = element_text(
        size = 20, family = "serif", face = "bold"
      ), 
      plot.subtitle = element_textbox_simple(
      size = 18, family = "serif", color = "gray30",
      margin = margin(t = 2,
            b = 5)
      ), plot.caption.position = "plot",
      plot.caption = element_text(size = 12,
      color = "gray50", hjust = 0))

```

